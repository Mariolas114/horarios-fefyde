<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Horarios - FEFyDE UAS</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <style>
        :root {
            --uas-blue: #002F6C;
            --uas-gold: #D4AF37;
            --dark-gray: #000;
        }

        * { box-sizing: border-box; font-family: 'Arial', sans-serif; }
        body { background-color: #e9ecef; margin: 0; padding: 20px; color: var(--dark-gray); }

        /* --- UI NO IMPRIMIBLE --- */
        .control-panel {
            background: white; padding: 15px; border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 20px;
            display: flex; flex-wrap: wrap; gap: 15px; align-items: flex-end;
            border-top: 5px solid var(--uas-blue);
        }
        .control-group { display: flex; flex-direction: column; flex: 1; min-width: 150px; }
        .control-group label { font-size: 11px; font-weight: bold; margin-bottom: 5px; color: #555; text-transform: uppercase; }
        select, input { padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 100%; }
        
        .btn-action { padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; color: white; text-align: center; background-color: var(--uas-blue); transition: 0.2s;}
        .btn-action:hover { opacity: 0.9; }
        
        /* Botones especiales */
        .btn-admin { background-color: #444; }
        .btn-save { background-color: #27ae60; display: none; } /* Oculto por defecto */
        .btn-reset { background-color: #c0392b; font-size: 10px; padding: 5px; margin-top: 5px; }

        /* --- DOCUMENTO --- */
        #main-container { width: 100%; max-width: 1200px; margin: 0 auto; }

        .schedule-page {
            background: white; 
            padding: 20px 40px;
            margin-bottom: 40px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            min-height: 750px; 
            page-break-after: always;
            position: relative;
        }

        /* HEADER */
        .doc-header { text-align: center; border-bottom: 2px solid var(--uas-gold); margin-bottom: 5px; }
        .header-logos { display: flex; justify-content: space-between; align-items: center; padding: 5px 0; height: 90px; }
        .logo-img { max-height: 80px; max-width: 120px; object-fit: contain; }
        
        .university-title h1 { margin: 0; font-size: 18px; color: var(--uas-blue); text-transform: uppercase; letter-spacing: 1px; }
        .university-title h2 { margin: 5px 0; font-size: 13px; background-color: var(--uas-blue); color: white; padding: 4px; display: inline-block; width: 100%; }

        .info-bar { background-color: var(--uas-gold); color: black; font-weight: bold; display: flex; justify-content: space-between; padding: 4px 20px; font-size: 11px; border-top: 2px solid var(--uas-blue); border-bottom: 2px solid var(--uas-blue); }
        .group-bar { background-color: var(--uas-blue); color: white; text-align: center; font-size: 16px; font-weight: bold; padding: 6px; text-transform: uppercase; margin-top: 2px; }
        .sub-header { text-align: center; font-weight: bold; margin: 5px 0 10px 0; font-size: 12px; background-color: #f0f0f0; padding: 3px; border: 1px solid #000; }

        /* TABLA */
        .schedule-table { 
            width: 100%; border-collapse: collapse; font-size: 10px; margin-bottom: 10px; table-layout: fixed; 
            border: 2px solid #000; 
        }
        .schedule-table th, .schedule-table td { 
            border: 1px solid #000; padding: 4px; text-align: center; vertical-align: top; word-wrap: break-word; 
        }
        .schedule-table th { font-weight: bold; text-transform: uppercase; height: 30px; font-size: 9px; vertical-align: middle; }
        .schedule-table td { height: 60px; }

        /* MODO EDICI√ìN */
        .editable-mode td { cursor: text; }
        .editable-mode td:hover { background-color: #fff9c4; outline: 1px dashed #999; }
        .modified-indicator { color: #27ae60; font-size: 12px; font-weight: bold; display: none; }

        /* COLORES Y ANCHOS */
        .header-materia { background-color: #A6192E; color: white; }
        .header-docente { background-color: #C8A2C8; color: black; }
        .header-lunes { background-color: #B2D235; } .header-martes { background-color: #FFD700; }
        .header-miercoles { background-color: #FFB6C1; } .header-jueves { background-color: #00FFFF; }
        .header-viernes { background-color: #FF8C00; } .header-total { background-color: #FFFF00; }

        .col-materia { width: 22%; text-align: left; font-weight: bold; font-size: 9px; }
        .col-docente { width: 18%; text-transform: uppercase; font-size: 8px; }
        .col-dia { width: 10%; font-weight: bold; font-size: 10px; white-space: pre-wrap; }
        .col-total { width: 6%; font-weight: bold; }

        /* FOOTER */
        .doc-footer { margin-top: 20px; text-align: center; page-break-inside: avoid; }
        .director-info { font-weight: bold; font-size: 12px; margin-bottom: 5px; }
        .date-range-display { font-weight: bold; text-transform: uppercase; font-size: 12px; border-top: 1px solid #000; display: inline-block; padding-top: 5px; min-width: 300px; }

        @media print {
            body, html { margin: 0; padding: 0; background: white; width: 100%; height: 100%; }
            .control-panel { display: none !important; }
            #main-container { width: 100%; margin: 0; padding: 0; }
            .schedule-page { box-shadow: none; margin: 0 auto; border: none; width: 100%; height: 100vh; display: flex; flex-direction: column; justify-content: center; padding: 10mm; }
            .editable-mode td { outline: none !important; background-color: transparent !important; }
            @page { size: landscape; margin: 0; }
        }
    </style>
</head>
<body>

    <div class="control-panel" data-html2canvas-ignore="true">
        <div class="control-group">
            <label>1. Licenciatura</label>
            <select id="select-licenciatura" onchange="updateGroupDropdown()">
                <option value="LEF">LIC. EDUCACI√ìN F√çSICA (LEF)</option>
                <option value="LAFS">LIC. ACT. F√çSICA Y SALUD (LAFS)</option>
                <option value="LED">LIC. ENTRENAMIENTO DEP. (LED)</option>
            </select>
        </div>
        <div class="control-group">
            <label>2. Grupo</label>
            <select id="select-grupo" onchange="renderApp()"></select>
        </div>
        <div class="control-group">
            <label>Fechas</label>
            <input type="date" id="date-start" onchange="updateAllDates()">
            <input type="date" id="date-end" onchange="updateAllDates()" style="margin-top:2px;">
        </div>
        
        <div class="control-group" style="flex: 0 0 140px;">
             <label>Administrador</label>
             <button id="btn-edit-mode" class="btn-action btn-admin" onclick="toggleEditMode()">üõ†Ô∏è EDITAR</button>
             <button id="btn-save-local" class="btn-action btn-save" onclick="saveToLocal()">üíæ GUARDAR</button>
             <span id="save-msg" class="modified-indicator">¬°Guardado!</span>
        </div>

        <div class="control-group" style="flex: 0 0 100px;">
            <label>Salida</label>
            <button class="btn-action" onclick="window.print()">üñ®Ô∏è IMPRIMIR</button>
            <button class="btn-action btn-reset" onclick="resetFactory()">‚ö†Ô∏è RESET</button>
        </div>
    </div>

    <div id="main-container"></div>

    <script>
        // --- BASE DE DATOS COMPLETA ---
        const DEFAULT_DB = {
            "LEF": {
                // 1¬∫ GRADO
                "1-01": [
                    {materia:"BIOQU√çMICA Y FISIOLOG√çA DE LA ACTIVIDAD F√çSICA", docente:"SERRANO SANCHEZ FERNANDO ALBERTO", l:"", m:"", x:"11:00 A 13:00", j:"8:00 A 9:00", v:"6:30 A 8:00", t:"5"},
                    {materia:"FUNDAMENTOS DE PEDAGOG√çA DE LA MOTRICIDAD", docente:"LEON CA√ëEDO CYNTHIA BERENICE", l:"12:00 A 13:00", m:"", x:"6:30 A 8:00", j:"", v:"10:00 A 12:00", t:"5"},
                    {materia:"FUNDAMENTOS DE LA NUTRICI√ìN HUMANA", docente:"BON CONCHO KATHERYNE SUJEY", l:"6:30 A 8:00", m:"6:30 A 8:00", x:"", j:"10:00 A 12:00", v:"", t:"5"},
                    {materia:"T√âCNICAS GIMN√ÅSTICAS", docente:"HERN√ÅNDEZ D√çAZ MACIEL EDITH", l:"10:00 A 12:00", m:"10:00 A 12:00", x:"", j:"12:00 A 13:00", v:"", t:"5"},
                    {materia:"ACTIVIDADES ACU√ÅTICAS", docente:"REYES MARISCAL GERARDO REYES", l:"", m:"8:00 A 10:00", x:"10:00 A 11:00", j:"", v:"8:00 A 10:00", t:"5"},
                    {materia:"FUNDAMENTOS DEL ATLETISMO", docente:"CORVERA BALLARDO JOSE EDUARDO", l:"8:00 A 10:00", m:"12:00 A 13:00", x:"8:00 A 10:00", j:"", v:"", t:"5"}
                ],
                "1-02": [
                    {materia:"BIOQU√çMICA Y FISIOLOG√çA DE LA ACTIVIDAD F√çSICA", docente:"BUELNA ARCE LUIS ARTURO", l:"", m:"9:00 A 11:00", x:"", j:"10:00 A 12:00", v:"11:00 A 12:00", t:"5"},
                    {materia:"FUNDAMENTOS DE PEDAGOG√çA DE LA MOTRICIDAD", docente:"LEON CA√ëEDO CYNTHIA BERENICE", l:"10:00 A 12:00", m:"11:00 A 13:00", x:"8:00 A 9:00", j:"", v:"", t:"5"},
                    {materia:"FUNDAMENTOS DE LA NUTRICI√ìN HUMANA", docente:"MANJARREZ BASTIDAS ITZEL ADILENE", l:"", m:"", x:"09:00 A 11:00", j:"", v:"09:00 A 11:00", t:"5"},
                    {materia:"T√âCNICAS GIMN√ÅSTICAS", docente:"FRAUSTO LERMA LILIA MARLEN", l:"", m:"6:30 A 8:00", x:"6:30 A 8:00", j:"6:30 A 8:00", v:"", t:"5"},
                    {materia:"ACTIVIDADES ACU√ÅTICAS", docente:"BERRELLEZA REYES GILBERTO", l:"8:00 A 10:00", m:"8:00 A 9:00", x:"", j:"8:00 A 10:00", v:"", t:"5"},
                    {materia:"FUNDAMENTOS DEL ATLETISMO", docente:"ARANA BORREGO CHRISTIAN DAVID", l:"6:30 A 8:00", m:"", x:"11:00 A 13:00", j:"", v:"8:00 A 9:00", t:"5"}
                ],
                "1-03": [
                    {materia:"BIOQU√çMICA Y FISIOLOG√çA DE LA ACTIVIDAD F√çSICA", docente:"ESPINOZA RODR√çGUEZ JOS√â ABEL", l:"14:30 A 16:00", m:"14:30 A 16:00", x:"", j:"", v:"18:30 A 20:00", t:"5"},
                    {materia:"FUNDAMENTOS DE PEDAGOG√çA DE LA MOTRICIDAD", docente:"VERGARA ESCOBAR ELIZABETH", l:"16:00 A 18:00", m:"", x:"17:00 A 19:00", j:"", v:"15:00 A 16:00", t:"5"},
                    {materia:"FUNDAMENTOS DE LA NUTRICI√ìN HUMANA", docente:"ESPINOZA RODR√çGUEZ JOS√â ABEL", l:"13:30 A 14:30", m:"", x:"13:00 A 15:00", j:"", v:"13:00 A 15:00", t:"5"},
                    {materia:"T√âCNICAS GIMN√ÅSTICAS", docente:"CORONA GUERRERO OCTAVIO URIEL", l:"18:00 A 19:00", m:"18:00 A 20:00", x:"", j:"", v:"16:00 A 18:00", t:"5"},
                    {materia:"ACTIVIDADES ACU√ÅTICAS", docente:"MALDONADO VALENZUELA JOS√â MANUEL", l:"19:00 A 20:00", m:"", x:"15:00 A 16:00", j:"13:00 A 16:00", v:"", t:"5"},
                    {materia:"FUNDAMENTOS DEL ATLETISMO", docente:"ARANA BORREGO CHRISTIAN DAVID", l:"", m:"16:00 A 18:00", x:"16:00 A 17:00", j:"16:00 A 18:00", v:"", t:"5"}
                ],
                "1-04": [
                    {materia:"BIOQU√çMICA Y FISIOLOG√çA DE LA ACTIVIDAD F√çSICA", docente:"ESPINOZA RODR√çGUEZ JOS√â ABEL", l:"16:00 A 18:00", m:"", x:"17:00 A 18:00", j:"", v:"15:00 A 17:00", t:"5"},
                    {materia:"FUNDAMENTOS DE PEDAGOG√çA DE LA MOTRICIDAD", docente:"VERGARA ESCOBAR ELIZABETH", l:"14:00 A 16:00", m:"", x:"14:00 A 15:00", j:"", v:"13:00 A 15:00", t:"5"},
                    {materia:"FUNDAMENTOS DE LA NUTRICI√ìN HUMANA", docente:"ESPINOZA SALOM√ìN ANA SAILE", l:"13:00 A 14:00", m:"15:00 A 17:00", x:"", j:"15:00 A 17:00", v:"", t:"5"},
                    {materia:"T√âCNICAS GIMN√ÅSTICAS", docente:"FRAUSTO LERMA LILIA MARLEN", l:"", m:"18:00 A 19:30", x:"18:00 A 20:00", j:"18:00 A 19:30", v:"", t:"5"},
                    {materia:"ACTIVIDADES ACU√ÅTICAS", docente:"GARZON GAYTAN NANCY", l:"", m:"13:00 A 15:00", x:"", j:"13:00 A 15:00", v:"17:00 A 18:00", t:"5"},
                    {materia:"FUNDAMENTOS DEL ATLETISMO", docente:"ARANA BORREGO CHRISTIAN DAVID", l:"18:00 A 20:00", m:"", x:"15:00 A 16:00", j:"", v:"18:00 A 20:00", t:"5"}
                ],
                // 2¬∫ GRADO
                "2-01": [
                    {materia:"M√âTODOS DE ENSE√ëANZA APRENDIZAJE", docente:"CHINCHILLAS SALAZAR FRANCISCA ELVIRA", l:"8:00 A 10:00", m:"", x:"8:00 A 10:00", j:"", v:"8:00 A 9:00", t:"5"},
                    {materia:"TEOR√çAS DEL APRENDIZAJE", docente:"CERVANTES GONZ√ÅLEZ MANUEL OCTAVIO", l:"", m:"8:30 A 10:00", x:"", j:"8:30 A 10:00", v:"6:30 A 8:00", t:"5"},
                    {materia:"EDUCACI√ìN F√çSICA EN NIVEL PREESCOLAR", docente:"OLIVAS QUINTERO MARCO ANTONIO", l:"", m:"6:30 A 8:30", x:"", j:"6:30 A 8:30", v:"", t:"5"},
                    {materia:"LEGISLACI√ìN EDUCATIVA Y DEPORTIVA", docente:"VALDEZ CAMACHO ELOY", l:"6:30 A 8:00", m:"", x:"6:30 A 8:00", j:"", v:"11:00 A 13:00", t:"5"},
                    {materia:"B√ÅSQUETBOL", docente:"MEDINA LE√ìN FERNANDO", l:"10:00 A 12:00", m:"10:00 A 12:00", x:"", j:"", v:"", t:"5"},
                    {materia:"B√âISBOL", docente:"SOTO PE√ëA CARLOS ARMANDO", l:"", m:"", x:"10:00 A 11:00", j:"10:00 A 12:00", v:"9:00 A 11:00", t:"5"}
                ],
                "2-02": [
                    {materia:"M√âTODOS DE ENSE√ëANZA APRENDIZAJE", docente:"CHINCHILLAS SALAZAR FRANCISCA ELVIRA", l:"10:00 A 12:00", m:"", x:"10:00 A 12:00", j:"", v:"9:00 A 10:00", t:"5"},
                    {materia:"TEOR√çAS DEL APRENDIZAJE", docente:"CERVANTES GONZ√ÅLEZ MANUEL OCTAVIO", l:"", m:"7:00 A 8:00", x:"8:00 A 10:00", j:"6:30 A 8:30", v:"", t:"5"},
                    {materia:"EDUCACI√ìN F√çSICA EN NIVEL PREESCOLAR", docente:"OLIVAS QUINTERO MARCO ANTONIO", l:"6:30 A 8:00", m:"", x:"6:30 A 8:00", j:"", v:"6:30 A 8:30", t:"5"},
                    {materia:"LEGISLACI√ìN EDUCATIVA Y DEPORTIVA", docente:"LE√ìN CA√ëEDO CYNTHIA BERENICE", l:"", m:"", x:"12:00 A 13:00", j:"9:00 A 12:00", v:"12:00 A 13:00", t:"5"},
                    {materia:"B√ÅSQUETBOL", docente:"MEDINA LE√ìN FERNANDO", l:"8:00 A 10:00", m:"8:00 A 10:00", x:"", j:"", v:"", t:"5"},
                    {materia:"B√âISBOL", docente:"AVENDA√ëO SOTO IV√ÅN DE JES√öS", l:"12:00 A 13:00", m:"10:00 A 12:00", x:"", j:"", v:"10:00 A 12:00", t:"5"}
                ],
                "2-03": [
                    {materia:"M√âTODOS DE ENSE√ëANZA APRENDIZAJE", docente:"LE√ìN CA√ëEDO CYNTHIA BERENICE", l:"16:00 A 18:00", m:"17:00 A 18:00", x:"", j:"17:00 A 19:00", v:"", t:"5"},
                    {materia:"TEOR√çAS DEL APRENDIZAJE", docente:"VEJAR TORRES ARACELI", l:"13:00 A 15:00", m:"16:00 A 17:00", x:"", j:"", v:"13:00 A 15:00", t:"5"},
                    {materia:"EDUCACI√ìN F√çSICA EN NIVEL PREESCOLAR", docente:"SAINZ BORBON MARIA DE LA LUZ", l:"15:00 A 16:00", m:"13:00 A 15:00", x:"15:00 A 17:00", j:"", v:"", t:"5"},
                    {materia:"LEGISLACI√ìN EDUCATIVA Y DEPORTIVA", docente:"AGUILAR REYES LUIS FELIPE", l:"", m:"", x:"13:00 A 15:00", j:"13:00 A 15:00", v:"15:00 A 16:00", t:"5"},
                    {materia:"B√ÅSQUETBOL", docente:"BELTRAN LOPEZ JORGE DE JESUS", l:"", m:"", x:"17:00 A 19:00", j:"15:00 A 17:00", v:"16:00 A 17:00", t:"5"},
                    {materia:"B√âISBOL", docente:"CHAVEZ VALDEZ ADRIAN IGNACIO", l:"18:00 A 20:00", m:"18:00 A 20:00", x:"", j:"", v:"17:00 A 18:00", t:"5"}
                ],
                "2-04": [
                    {materia:"M√âTODOS DE ENSE√ëANZA APRENDIZAJE", docente:"BELTRAN LOPEZ JORGE DE JESUS", l:"", m:"", x:"13:00 A 15:00", j:"13:00 A 15:00", v:"15:00 A 16:00", t:"5"},
                    {materia:"TEOR√çAS DEL APRENDIZAJE", docente:"VEJAR TORRES ARACELI", l:"", m:"", x:"15:00 A 17:00", j:"15:00 A 17:00", v:"16:00 A 17:00", t:"5"},
                    {materia:"EDUCACI√ìN F√çSICA EN NIVEL PREESCOLAR", docente:"LE√ìN CA√ëEDO CYNTHIA BERENICE", l:"13:00 A 14:00", m:"15:00 A 17:00", x:"", j:"", v:"13:00 A 15:00", t:"5"},
                    {materia:"LEGISLACI√ìN EDUCATIVA Y DEPORTIVA", docente:"SANCHEZ RODRIGUEZ GRECIA", l:"17:00 A 19:00", m:"17:00 A 20:00", x:"", j:"", v:"", t:"5"},
                    {materia:"B√ÅSQUETBOL", docente:"REYES C√âSAR ALBERTO", l:"14:00 A 17:00", m:"13:00 A 15:00", x:"", j:"", v:"", t:"5"},
                    {materia:"B√âISBOL", docente:"CHAVEZ VALDEZ ADRIAN IGNACIO", l:"", m:"", x:"17:00 A 19:00", j:"17:00 A 20:00", v:"", t:"5"}
                ],
                // 3¬∫ GRADO
                "3-01": [
                    {materia:"TALLER DE PROYECTOS DE INVESTIGACI√ìN", docente:"MONREAL ORT√çZ LUIS ROBERTO", l:"", m:"9:00 A 11:00", x:"", j:"11:00 A 13:00", v:"11:00 A 12:00", t:"5"},
                    {materia:"ORGANIZACI√ìN DE EVENTOS RECREATIVOS", docente:"SOTO PE√ëA CARLOS ARMANDO", l:"8:00 A 10:00", m:"", x:"8:00 A 10:00", j:"8:00 A 9:00", v:"", t:"5"},
                    {materia:"EDUCACI√ìN F√çSICA EN NIVEL PRIMARIA ALTA", docente:"SAINZ BORBON MARIA DE LA LUZ", l:"10:00 A 12:00", m:"", x:"10:00 A 12:00", j:"", v:"8:00 A 9:00", t:"5"},
                    {materia:"BAILES Y DANZAS REGIONALES", docente:"CHINCHILLAS SALAZAR FRANCISCA ELVIRA", l:"", m:"11:00 A 13:00", x:"12:00 A 13:00", j:"9:00 A 11:00", v:"", t:"5"},
                    {materia:"TEOR√çAS Y T√âCNICAS DE LA RECREACI√ìN", docente:"HERN√ÅNDEZ D√çAZ MACIEL EDITH", l:"12:00 A 13:00", m:"6:30 A 08:00", x:"", j:"", v:"9:00 A 11:00", t:"5"},
                    {materia:"DEPORTES DE RAQUETA", docente:"HIGUERA NAJAR JULIO CESAR", l:"7:00 A 8:00", m:"8:00 A 9:00", x:"6:30 A 08:00", j:"6:30 A 08:00", v:"", t:"5"}
                ],
                "3-02": [
                    {materia:"TALLER DE PROYECTOS DE INVESTIGACI√ìN", docente:"MONREAL ORT√çZ LUIS ROBERTO", l:"", m:"11:00 A 13:00", x:"", j:"09:00 A 11:00", v:"8:00 A 9:00", t:"5"},
                    {materia:"ORGANIZACI√ìN DE EVENTOS RECREATIVOS", docente:"SOTO PE√ëA CARLOS ARMANDO", l:"", m:"09:00 A 11:00", x:"", j:"", v:"11:00 A 13:00", t:"5"},
                    {materia:"EDUCACI√ìN F√çSICA EN NIVEL PRIMARIA ALTA", docente:"VEJAR TORRES ARACELI", l:"10:00 A 12:00", m:"8:00 A 9:00", x:"10:00 A 12:00", j:"", v:"", t:"5"},
                    {materia:"BAILES Y DANZAS REGIONALES", docente:"URIARTE CAMARGO VALERIA", l:"6:30 A 8:00", m:"", x:"12:00 A 13:00", j:"", v:"09:00 A 11:00", t:"5"},
                    {materia:"TEOR√çAS Y T√âCNICAS DE LA RECREACI√ìN", docente:"AGUILAR REYES EDGAR", l:"8:00 A 10:00", m:"", x:"7:00 A 8:00", j:"7:00 A 9:00", v:"", t:"5"},
                    {materia:"DEPORTES DE RAQUETA", docente:"HIGUERA NAJAR JULIO CESAR", l:"", m:"7:00 A 8:00", x:"8:00 A 10:00", j:"11:00 A 13:00", v:"", t:"5"}
                ],
                "3-03": [
                    {materia:"TALLER DE PROYECTOS DE INVESTIGACI√ìN", docente:"PEREZ TORRES MARCOS ANTONIO", l:"", m:"", x:"", j:"17:00 A 20:00", v:"15:00 A 17:00", t:"5"},
                    {materia:"ORGANIZACI√ìN DE EVENTOS RECREATIVOS", docente:"LE√ìN CA√ëEDO CYNTHIA BERENICE", l:"14:00 A 16:00", m:"13:00 A 15:00", x:"", j:"13:00 A 14:00", v:"", t:"5"},
                    {materia:"EDUCACI√ìN F√çSICA EN NIVEL PRIMARIA ALTA", docente:"RAMOS URQUIDEZ DIEGO", l:"13:00 A 14:00", m:"", x:"18:00 A 20:00", j:"15:00 A 17:00", v:"", t:"5"},
                    {materia:"BAILES Y DANZAS REGIONALES", docente:"VALENZUELA PEREZ PERLA GREGORIA", l:"", m:"15:00 A 17:00", x:"", j:"14:00 A 15:00", v:"13:00 A 15:00", t:"5"},
                    {materia:"TEOR√çAS Y T√âCNICAS DE LA RECREACI√ìN", docente:"RUIZ NAVA JESUS ALEJANDRO", l:"", m:"17:00 A 19:00", x:"15:00 A 18:00", j:"", v:"", t:"5"},
                    {materia:"DEPORTES DE RAQUETA", docente:"ACOSTA ARMENTA HECTOR DANIEL", l:"16:00 A 17:00", m:"", x:"13:00 A 15:00", j:"", v:"17:00 A 18:00", t:"5"}
                ],
                "3-04": [
                    {materia:"TALLER DE PROYECTOS DE INVESTIGACI√ìN", docente:"RAM√çREZ TORRES GIOVANNI ISA√ç", l:"17:00 A 18:00", m:"17:00 A 19:00", x:"15:00 A 17:00", j:"", v:"", t:"5"},
                    {materia:"ORGANIZACI√ìN DE EVENTOS RECREATIVOS", docente:"DIAZ SOTO JUSSIVIA", l:"13:00 A 15:00", m:"19:00 A 20:00", x:"", j:"15:00 A 17:00", v:"", t:"5"},
                    {materia:"EDUCACI√ìN F√çSICA EN NIVEL PRIMARIA ALTA", docente:"RAMOS URQU√çDEZ DIEGO", l:"15:00 A 17:00", m:"15:00 A 17:00", x:"17:00 A 18:00", j:"", v:"", t:"5"},
                    {materia:"BAILES Y DANZAS REGIONALES", docente:"ASTORGA RAMIREZ JESUS ESMERALDA", l:"", m:"", x:"18:00 A 19:00", j:"17:00 A 19:00", v:"15:00 A 17:00", t:"5"},
                    {materia:"TEOR√çAS Y T√âCNICAS DE LA RECREACI√ìN", docente:"RIOS AVILEZ CESAR ARMANDO", l:"", m:"13:00 A 15:00", x:"13:00 A 15:00", j:"19:00 A 20:00", v:"", t:"5"},
                    {materia:"DEPORTES DE RAQUETA", docente:"ACOSTA ARMENTA HECTOR DANIEL", l:"", m:"", x:"", j:"13:00 A 15:00", v:"13:00 A 15:00", t:"5"}
                ],
                // 4¬∫ GRADO
                "4-01": [
                    {materia:"EDUCACI√ìN F√çSICA EN EL NIVEL SECUNDARIA", docente:"AVENDA√ëO SOTO IV√ÅN DE JES√öS", l:"8:00 A 10:00", m:"", x:"9:00 A 11:00", j:"8:00 A 10:00", v:"", t:"6"},
                    {materia:"CAMPAMENTO EDUCATIVO", docente:"SOTO PE√ëA CARLOS ARMANDO", l:"12:00 A 13:00", m:"7:00 A 9:00", x:"", j:"", v:"", t:"3"},
                    {materia:"SEMINARIO DE TITULACI√ìN", docente:"HERNANDEZ MURUA JOSE ALDO", l:"", m:"11:00 A 13:00", x:"11:00 A 13:00", j:"10:00 A 12:00", v:"", t:"6"},
                    {materia:"REHABILITACI√ìN F√çSICA (OPTATIVA)", docente:"CARRANZA P√âREZ ERANDI", l:"", m:"9:00 A 11:00", x:"8:00 A 9:00", j:"", v:"", t:"3"},
                    {materia:"EDUCACI√ìN F√çSICA NIVEL BACHILLERATO (OPT)", docente:"ARAUJO SALCEDO DOLORES RICARDO", l:"10:00 A 12:00", m:"", x:"", j:"12:00 A 13:00", v:"", t:"3"}
                ],
                "4-02": [
                    {materia:"EDUCACI√ìN F√çSICA EN EL NIVEL SECUNDARIA", docente:"SOTO PE√ëA CARLOS ARMANDO", l:"", m:"11:00 A 13:00", x:"11:00 A 13:00", j:"", v:"07:00 A 09:00", t:"6"},
                    {materia:"CAMPAMENTO EDUCATIVO", docente:"HERNANDEZ D√çAZ MACIEL EDITH", l:"08:00 A 09:00", m:"", x:"", j:"", v:"11:00 A 13:00", t:"3"},
                    {materia:"SEMINARIO DE TITULACI√ìN", docente:"MADRID VELARDE X√ìCHITL VIRIDIANA", l:"9:00 A 11:00", m:"", x:"9:00 A 11:00", j:"", v:"9:00 A 11:00", t:"6"},
                    {materia:"REHABILITACI√ìN F√çSICA (OPTATIVA)", docente:"CARRANZA P√âREZ ERANDI", l:"11:00 A 13:00", m:"7:00 A 8:00", x:"", j:"", v:"", t:"3"},
                    {materia:"EDUCACI√ìN F√çSICA NIVEL BACHILLERATO (OPT)", docente:"AVENDA√ëO SOTO IV√ÅN DE JES√öS", l:"", m:"8:00 A 10:00", x:"8:00 A 9:00", j:"", v:"", t:"3"}
                ],
                "4-03": [
                    {materia:"EDUCACI√ìN F√çSICA EN EL NIVEL SECUNDARIA", docente:"CHAVEZ VALDEZ ADRIAN IGNACIO", l:"", m:"15:00 A 17:00", x:"15:00 A 17:00", j:"15:00 A 17:00", v:"", t:"6"},
                    {materia:"CAMPAMENTO EDUCATIVO", docente:"ARAUJO SALCEDO DOLORES RICARDO", l:"15:00 A 17:00", m:"", x:"17:00 A 18:00", j:"", v:"", t:"3"},
                    {materia:"SEMINARIO DE TITULACI√ìN", docente:"HERNANDEZ MURUA JOSE ALDO", l:"13:00 A 15:00", m:"13:00 A 15:00", x:"13:00 A 15:00", j:"", v:"", t:"6"},
                    {materia:"REHABILITACI√ìN F√çSICA (OPTATIVA)", docente:"RODRIGUEZ LOPEZ ARTURO", l:"", m:"18:00 A 20:00", x:"", j:"17:00 A 18:00", v:"", t:"3"},
                    {materia:"EDUCACI√ìN F√çSICA NIVEL BACHILLERATO (OPT)", docente:"TIZOC MENDOZA CARLOS HUMBERTO", l:"", m:"17:00 A 18:00", x:"", j:"13:00 A 15:00", v:"", t:"3"}
                ],
                "4-04": [
                    {materia:"EDUCACI√ìN F√çSICA EN EL NIVEL SECUNDARIA", docente:"AVENDA√ëO SOTO IV√ÅN DE JES√öS", l:"", m:"", x:"13:00 A 15:00", j:"18:00 A 20:00", v:"13:00 A 15:00", t:"6"},
                    {materia:"CAMPAMENTO EDUCATIVO", docente:"HERNANDEZ D√çAZ MACIEL EDITH", l:"", m:"", x:"", j:"15:00 A 18:00", v:"", t:"3"},
                    {materia:"SEMINARIO DE TITULACI√ìN", docente:"OCEGUERA RU√çZ ALMA LETICIA", l:"", m:"13:00 A 15:00", x:"16:00 A 17:00", j:"13:00 A 15:00", v:"", t:"6"},
                    {materia:"REHABILITACI√ìN F√çSICA (OPTATIVA)", docente:"REYES MARISCAL GERARDO", l:"", m:"", x:"15:00 A 16:00", j:"", v:"16:00 A 18:00", t:"3"},
                    {materia:"EDUCACI√ìN F√çSICA NIVEL BACHILLERATO (OPT)", docente:"TIZOC MENDOZA CARLOS HUMBERTO", l:"", m:"15:00 A 17:00", x:"", j:"", v:"15:00 A 16:00", t:"3"}
                ]
            },
            "LAFS": {
                "1-01": [
                    {materia: "FISIOLOG√çA HUMANA", docente: "ESPINOZA RODRIGUEZ JOSE ABEL", l: "18:00 A 19:00", m: "18:00 A 20:00", x: "", j: "16:00 A 18:00", v: "", t: "5"},
                    {materia: "NUTRICI√ìN HUMANA", docente: "ESPINOZA RODRIGUEZ JOSE ABEL", l: "", m: "", x: "15:00 A 17:00", j: "18:00 A 19:30", v: "17:00 A 18:30", t: "5"},
                    {materia: "PSICOLOG√çA DE LA ACTIVIDAD F√çSICA", docente: "BELTR√ÅN L√ìPEZ  JOS√â ENRIQUE", l: "15:00 A 17:00", m: "15:00 A 17:00", x: "14:00 A 15:00", j: "", v: "", t: "5"},
                    {materia: "EJERCICIO F√çSICO EN EL MEDIO ACU√ÅTICO", docente: "REYES MARISCAL GERARDO", l: "13:00 A 15:00", m: "13:00 A 15:00", x: "", j: "13:00 A 14:00", v: "", t: "5"},
                    {materia: "T√âCNICAS DE LA GIMNASIA B√ÅSICA", docente: "URIARTE CAMARGO HOLANDA", l: "", m: "", x: "17:00 A 20:00", j: "", v: "13:00 A 15:00", t: "5"},
                    {materia: "T√âCNICAS DEL ATLETISMO", docente: "SANCHEZ CASTRO RAMON ALBERTO", l: "17:00 A 18:00", m: "", x: "", j: "14:00 A 16:00", v: "15:00 A 17:00", t: "5"}
                ],
                "2-01": [
                    {materia: "EVALUCION DE LA ACTIVIDAD FISICA", docente: "BUELNA ARCE LUIS ARTURO", l: "", m: "13:00 A 15:00", x: "13:00 A 15:00", j: "13:00 A 14:00", v: "", t: "5"},
                    {materia: "KINEANTROPOMETRIA", docente: "GASTELUM ACOSTA PEDRO ERICK", l: "17:00 A 19:00", m: "16:00 A 18:00", x: "", j: "17:00 A 18:00", v: "", t: "5"},
                    {materia: "DISCAPACIDAD EN LA ACTIVIDAD FISICA", docente: "GASTELUM ACOSTA PEDRO ERICK", l: "19:00 A 20:00", m: "18:00 A 20:00", x: "", j: "", v: "17:00 A 19:00", t: "5"},
                    {materia: "PROGRAMA DE ACTIVIDAD FISICA EN LA INFANCIA", docente: "L√ìPEZ VENEGAS GABRIEL √ÅNGEL", l: "13:00 A 15:00", m: "", x: "17:00 A 18:00", j: "", v: "13:00 A 15:00", t: "5"},
                    {materia: "TECNICAS DE PRIMEROS AUXILIOS", docente: "MEJ√çA MONARREZ JAZZIEL GUSTAVO", l: "", m: "", x: "15:00 A 17:00", j: "14:00 A 15:00", v: "15:00 A 17:00", t: "5"},
                    {materia: "ESTADISTICA APLICADA A LA ACTIVIDAD FISICA", docente: "COTA TIRADO MARIO C√âSAR", l: "15:00 A 17:00", m: "15:00 A 16:00", x: "", j: "15:00 A 17:00", v: "", t: "5"}
                ],
                "3-01": [
                    {materia: "LIDERAZGO PROFESIONAL          EN LA ACTIVIDAD F√çSICA", docente: "ESPINOZA SALOM√ìN ANA SAILE", l: "14:00 A 16:00", m: "", x: "13:00 A 15:00", j: "19:00 A 20:00", v: "", t: "5"},
                    {materia: "ENTRENAMIENTO FUNCIONAL PARA LA SALUD", docente: "MADRIGAL OLIVARES BLAS SINAH√ç", l: "13:00 A 14:00", m: "17:00 A 19:00", x: "17:00 A 19:00", j: "", v: "", t: "5"},
                    {materia: "TRASTORNOS M√öSCULO ESQUEL√âTICOS", docente: "CORVERA NIEBLA PATRICIO", l: "18:00 A 19:00", m: "", x: "", j: "17:00 A 19:00", v: "17:00 A 19:00", t: "5"},
                    {materia: "PROGRAMA DE ACTIVIDAD   F√çSICA EN EL ADULTO JOVEN", docente: "HERNANDEZ MURUA JOSE ALDO", l: "", m: "15:00 A 17:00", x: "", j: "15:00 A 16:00", v: "15:00 A 17:00", t: "5"},
                    {materia: "REHABILITACI√ìN F√çSICA", docente: "LEDEZMA ORTEGA JOSE ALEJANDERO", l: "16:00 A 18:00", m: "", x: "15:00 A 17:00", j: "16:00 A 17:00", v: "", t: "5"},
                    {materia: "DISE√ëO DE PROYECTOS DE INVESTIGACI√ìN CIENT√çFICA", docente: "MONREAL ORT√çZ LUIS ROBERTO", l: "", m: "13:00 A 15:00", x: "", j: "14:00 A 15:00", v: "13:00 A 15:00", t: "5"}
                ],
                "4-01": [
                    {materia: "REHABILITACI√ìN F√çSICA", docente: "RODRIGUEZ LOPEZ ARTURO", l: "10:00  A 12:00", m: "9:00  A  10:00", x: "", j: "", v: "", t: "3"},
                    {materia: "ACTIVIDAD F√çSICA EN EL ADULTO MAYOR", docente: "SERRANO SANCHEZ FERNANDO ALBERTO", l: "", m: "6:30  A 8:30", x: "8:00  A 10:00", j: "9:00  A 11:00", v: "", t: "6"},
                    {materia: "PROYECTO DE TITULACI√ìN", docente: "SOTO PE√ëA CARLOS ARMANDO", l: "6:30  A 8:00", m: "", x: "6:30  A 8:00", j: "6:30  A 8:00", v: "", t: "6"},
                    {materia: "CALIDAD DE LOS SERVICIOS DEPORTIVOS (OPTATIVA)", docente: "", l: "", m: "10:00  A 12:00", x: "10:00  A 11:00", j: "", v: "", t: "3"},
                    {materia: "ASESOR√çA Y CONSULTOR√çA EN ORGANISMOS DEPORTIVOS (OPTATIVA)", docente: "VEJAR TORRES ARACELI", l: "8:00  A 10:00", m: "", x: "", j: "8:00  A  9:00", v: "", t: "3"}
                ]
            },
            "LED": {
                "1-01": [
                    {materia:"FISIOLOG√çA", docente:"ESPINOZA RODRIGUEZ JOSE ABEL", l:"", m:"16:00 A 18:00", x:"18:30 A 20:00", j:"14:30 A 16:00", v:"", t:"5"},
                    {materia:"PEDAGOG√çA DE LOS DEPORTES INDIVIDUALES", docente:"BELTR√ÅN L√ìPEZ JOS√â ENRIQUE", l:"17:00 A 19:00", m:"18:00 A 19:00", x:"15:00 A 17:00", j:"", v:"", t:"5"},
                    {materia:"GIMNASIA COMPETITIVA", docente:"HERNANDEZ D√çAZ MACIEL EDITH", l:"", m:"", x:"13:00 A 15:00", j:"13:00 A 14:00", v:"13:00 A 15:00", t:"5"},
                    {materia:"ACTIVIDADES ACU√ÅTICAS", docente:"BEJARANO LOYOLA EDGAR", l:"13:00 A 15:00", m:"13:00 A 16:00", x:"", j:"", v:"", t:"5"},
                    {materia:"FUNDAMENTOS DE ATLETISMO", docente:"ARANA BORREGO CHRISTIAN DAVID", l:"15:00 A 17:00", m:"", x:"", j:"16:00 A 17:00", v:"15:00 A 17:00", t:"5"},
                    {materia:"LEGISLACI√ìN Y ORGANIZACI√ìN DEL DEPORTE", docente:"ACOSTA LOPEZ DANIEL RAMON", l:"19:00 A 20:00", m:"", x:"17:00 A 18:30", j:"", v:"17:00 A 19:00", t:"5"}
                ],
                "2-01": [
                    {materia:"BIOMEC√ÅNICA DEL DEPORTE", docente:"SOTO FIERRRO MANUEL FERNANDO", l:"", m:"17:00 A 18:00", x:"", j:"15:00 A 17:00", v:"15:00 A 17:00", t:"5"},
                    {materia:"FUNDAMENTOS DE DEPORTES DE COMBATE", docente:"VEJAR TORRES ARACELI", l:"17:00 A 19:00", m:"15:00 A 16:00", x:"17:00 A 19:00", j:"", v:"", t:"5"},
                    {materia:"B√ÅDMINTON", docente:"ACOSTA ARMENTA HECTOR DANIEL", l:"13:00 A 15:00", m:"", x:"19:00 A 20:00", j:"", v:"18:00 A 20:00", t:"5"},
                    {materia:"EVALUACI√ìN DE LAS CAPACIDADES F√çSICAS", docente:"L√ìPEZ VENEGAS GABRIEL √ÅNGEL", l:"19:00 A 20:00", m:"13:00 A 15:00", x:"", j:"13:00 A 15:00", v:"", t:"5"},
                    {materia:"B√âISBOL", docente:"SANCHEZ ESPINOZA RAMON ALBERTO", l:"", m:"16:00 A 17:00", x:"13:00 A 15:00", j:"", v:"13:00 A 15:00", t:"5"},
                    {materia:"MERCADOTECNIA DEL DEPORTE", docente:"ACOSTA LOPEZ JESUS MANUEL", l:"15:00 A 17:00", m:"", x:"15:00 A 17:00", j:"17:00 A 18:00", v:"", t:"5"}
                ],
                "3-01": [
                    {materia:"NUTRICI√ìN DEPORTIVA", docente:"MEJ√çA MONARREZ JAZZIEL GUSTAVO", l:"18:00 A 19:00", m:"15:00 A 17:00", x:"18:00 A 20:00", j:"", v:"", t:"5"},
                    {materia:"VOLEIBOL", docente:"FERNANDEZ BELTRAN AGUSTIN", l:"19:00 A 20:00", m:"14:00 A 16:00", x:"17:00 A 19:00", j:"", v:"", t:"5"},
                    {materia:"KINESIO ANTROPOMETR√çA", docente:"BON CONCHO KATHERYNE SUJEY", l:"13:00 A 15:00", m:"15:00 A 17:00", x:"13:00 A 14:00", j:"", v:"", t:"5"},
                    {materia:"M√âTODOS MODERNOS DEL ENTRENAMIENTO", docente:"GUAJARDO CRUZTITLA JORGE LUIS", l:"15:00 A 17:00", m:"", x:"16:00 A 17:00", j:"", v:"13:00 A 15:00", t:"5"},
                    {materia:"F√öTBOL", docente:"AVENDA√ëO SOTO IV√ÅN DE JES√öS", l:"", m:"13:00 A 15:00", x:"", j:"13:00 A 15:00", v:"15:00 A 16:00", t:"5"},
                    {materia:"DISE√ëO DE PROYECTOS DE INVESTIGACI√ìN", docente:"ESPINOZA SALOM√ìN ANA SAILE", l:"17:00 A 19:00", m:"17:00 A 18:00", x:"", j:"", v:"16:00 A 18:00", t:"5"}
                ],
                "4-01": [
                    {materia:"DERECHO DEL DEPORTE", docente:"RAMOS URQUIDEZ DIEGO", l:"8:00 A 10:00", m:"", x:"", j:"8:00 A 10:00", v:"", t:"3"},
                    {materia:"DISE√ëO Y APLICACI√ìN DE PROGRAMAS", docente:"BUELNA ARCE LUIS ARTURO", l:"11:00 A 13:00", m:"11:00 A 13:00", x:"", j:"", v:"", t:"6"},
                    {materia:"PROYECTO DE TITULACI√ìN", docente:"VEJAR TORRES ARACELI", l:"", m:"9:00 A 11:00", x:"8:00 A 10:00", j:"10:00 A 12:00", v:"", t:"6"},
                    {materia:"ADMINISTRACI√ìN Y GESTI√ìN EN ORG. DEPORTIVAS", docente:"RIOS AVILES JORGE", l:"", m:"7:00 A 8:00", x:"", j:"", v:"", t:"3"}
                ]
            }
        };

        // Variable global de DB
        let DB = JSON.parse(JSON.stringify(DEFAULT_DB));

        // --- LOCALSTORAGE ---
        function loadFromLocal() {
            const saved = localStorage.getItem('horarios_db_v5'); // V5 con todos los grupos
            if (saved) {
                DB = JSON.parse(saved);
                console.log("Datos cargados de LocalStorage");
            }
        }

        function saveToLocal() {
            const lic = document.getElementById('select-licenciatura').value;
            const pages = document.querySelectorAll('.schedule-page');
            
            pages.forEach(page => {
                const groupTitle = page.querySelector('.group-bar').innerText;
                const groupMatch = groupTitle.match(/GRUPO:\s*([\d-]*)/);
                
                if (groupMatch) {
                    const grp = groupMatch[1].trim();
                    const tbody = page.querySelector('tbody');
                    const rows = tbody.querySelectorAll('tr');
                    
                    const newSchedule = [];
                    rows.forEach(row => {
                        const cols = row.querySelectorAll('td');
                        if (cols.length === 8) {
                            const mat = cols[0].innerText.trim();
                            if (mat) {
                                newSchedule.push({
                                    materia: mat,
                                    docente: cols[1].innerText.trim(),
                                    l: cols[2].innerText.trim(),
                                    m: cols[3].innerText.trim(),
                                    x: cols[4].innerText.trim(),
                                    j: cols[5].innerText.trim(),
                                    v: cols[6].innerText.trim(),
                                    t: cols[7].innerText.trim()
                                });
                            }
                        }
                    });
                    
                    if (!DB[lic]) DB[lic] = {};
                    DB[lic][grp] = newSchedule;
                }
            });

            localStorage.setItem('horarios_db_v5', JSON.stringify(DB));
            const msg = document.getElementById('save-msg');
            msg.style.display = 'inline';
            setTimeout(() => { msg.style.display = 'none'; }, 2000);
        }

        function resetFactory() {
            if(confirm("¬øEst√°s seguro? Se borrar√°n todos tus cambios guardados y volver√° a los datos originales.")) {
                localStorage.removeItem('horarios_db_v5');
                location.reload();
            }
        }

        // --- MODO EDITOR ---
        let isEditMode = false;
        function toggleEditMode() {
            if (!isEditMode) {
                const pass = prompt("Contrase√±a de Administrador:");
                if (pass === "Tijuana11") {
                    isEditMode = true;
                    document.body.classList.add('editable-mode');
                    document.getElementById('btn-edit-mode').textContent = "MODO EDICI√ìN (ACTIVO)";
                    document.getElementById('btn-edit-mode').classList.add('active');
                    document.getElementById('btn-save-local').style.display = 'inline-block';
                    refreshEditable();
                } else {
                    alert("Contrase√±a Incorrecta");
                }
            } else {
                isEditMode = false;
                document.body.classList.remove('editable-mode');
                document.getElementById('btn-edit-mode').textContent = "üõ†Ô∏è EDITAR";
                document.getElementById('btn-edit-mode').classList.remove('active');
                document.getElementById('btn-save-local').style.display = 'none';
                refreshEditable();
            }
        }

        function refreshEditable() {
            const cells = document.querySelectorAll('.schedule-table td');
            cells.forEach(cell => {
                cell.setAttribute('contenteditable', isEditMode);
            });
        }

        // --- RENDER ---
        function updateGroupDropdown() {
            const lic = document.getElementById('select-licenciatura').value;
            const selectGrupo = document.getElementById('select-grupo');
            selectGrupo.innerHTML = ""; 
            
            const optAll = document.createElement('option');
            optAll.value = "ALL";
            optAll.text = "--- VER TODOS LOS GRUPOS ---";
            optAll.style.fontWeight = "bold";
            selectGrupo.add(optAll);
            
            const grupos = Object.keys(DB[lic] || {}).sort();
            
            if (grupos.length === 0) {
               const opt = document.createElement('option');
               opt.text = "Sin grupos cargados";
               selectGrupo.add(opt);
            } else {
                grupos.forEach(g => {
                    const opt = document.createElement('option');
                    opt.value = g;
                    opt.text = `Grupo ${g}`;
                    selectGrupo.add(opt);
                });
            }
            renderApp();
        }

        function renderApp() {
            const container = document.getElementById('main-container');
            container.innerHTML = ""; 
            const lic = document.getElementById('select-licenciatura').value;
            const grupoSeleccionado = document.getElementById('select-grupo').value;
            let gruposARenderizar = [];

            if (grupoSeleccionado === "ALL") {
                gruposARenderizar = Object.keys(DB[lic] || {}).sort();
            } else {
                gruposARenderizar = [grupoSeleccionado];
            }

            if (gruposARenderizar.length === 0) {
                container.innerHTML = "<h3 style='text-align:center; padding:20px;'>No hay grupos disponibles.</h3>";
                return;
            }

            gruposARenderizar.forEach(grupo => {
                const data = DB[lic][grupo] || [];
                const htmlHoja = createSchedulePageHTML(lic, grupo, data);
                const div = document.createElement('div');
                div.innerHTML = htmlHoja;
                container.appendChild(div);
            });
            updateAllDates(); 
            if(isEditMode) refreshEditable();
        }

        function createSchedulePageHTML(lic, grupo, data) {
            const titulos = {
                "LEF": "LICENCIATURA EN EDUCACI√ìN F√çSICA",
                "LAFS": "LICENCIATURA EN ACTIVIDAD F√çSICA PARA LA SALUD",
                "LED": "LICENCIATURA EN ENTRENAMIENTO DEPORTIVO"
            };
            const nombreLic = titulos[lic] || lic;

            let filasHTML = "";
            // SIN RELLENO: Solo lo que hay en DB
            if(data && data.length > 0) {
                data.forEach(item => {
                    filasHTML += `
                        <tr>
                            <td class="col-materia">${item.materia}</td>
                            <td class="col-docente">${item.docente}</td>
                            <td class="col-dia">${item.l}</td>
                            <td class="col-dia">${item.m}</td>
                            <td class="col-dia">${item.x}</td>
                            <td class="col-dia">${item.j}</td>
                            <td class="col-dia">${item.v}</td>
                            <td class="col-total">${item.t}</td>
                        </tr>
                    `;
                });
            } else {
                 filasHTML = '<tr><td colspan="8" style="padding:20px; color:#aaa;">Sin materias cargadas</td></tr>';
            }

            return `
            <div class="schedule-page">
                <div class="doc-header">
                    <div class="header-logos">
                        <img src="assets/UAS_logo (1).png" class="logo-img" onerror="this.style.opacity=0">
                        <div class="university-title">
                            <img src="assets/8.jpg" style="height:40px; margin-bottom:5px" onerror="this.style.display='none'">
                            <h1>Universidad Aut√≥noma de Sinaloa</h1>
                            <h2>Facultad de Educaci√≥n F√≠sica y Deporte</h2>
                        </div>
                        <img src="assets/photo.jpg" class="logo-img" onerror="this.style.opacity=0">
                    </div>
                    <div class="info-bar">
                        <span>CICLO ESCOLAR: 2025-2026</span>
                        <span>SEMESTRE II (MARZO-AGOSTO)</span>
                    </div>
                    <div class="group-bar">GRUPO: ${grupo} ${nombreLic}</div>
                    <div class="sub-header">Control de Asistencia del Personal Acad√©mico</div>
                </div>

                <table class="schedule-table">
                    <thead>
                        <tr>
                            <th class="header-materia">UNIDAD DE APRENDIZAJE</th>
                            <th class="header-docente">NOMBRE DEL ACAD√âMICO</th>
                            <th class="header-lunes">LUNES</th>
                            <th class="header-martes">MARTES</th>
                            <th class="header-miercoles">MI√âRCOLES</th>
                            <th class="header-jueves">JUEVES</th>
                            <th class="header-viernes">VIERNES</th>
                            <th class="header-total">TOTAL</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${filasHTML}
                    </tbody>
                </table>

                <div class="doc-footer">
                    <div class="director-info">DR. DANIEL RAM√ìN ACOSTA L√ìPEZ<br>Director</div>
                    <div class="date-range-display">SEMANA DEL __ AL __ DE ________ DE 2025</div>
                </div>
            </div>
            `;
        }

        function updateAllDates() {
            const startInput = document.getElementById('date-start').value;
            const endInput = document.getElementById('date-end').value;
            const displays = document.querySelectorAll('.date-range-display');

            let texto = "SEMANA DEL __ AL __ DE ________ DE 2025";
            if (startInput && endInput) {
                const dateS = new Date(startInput + "T12:00:00");
                const dateE = new Date(endInput + "T12:00:00");
                const months = ["ENERO","FEBRERO","MARZO","ABRIL","MAYO","JUNIO","JULIO","AGOSTO","SEPTIEMBRE","OCTUBRE","NOVIEMBRE","DICIEMBRE"];
                
                const dayS = dateS.getDate().toString().padStart(2, '0');
                const dayE = dateE.getDate().toString().padStart(2, '0');
                const monthE = months[dateE.getMonth()];
                const yearE = dateE.getFullYear();
                texto = `SEMANA DEL ${dayS} AL ${dayE} DE ${monthE} DE ${yearE}`;
            }
            displays.forEach(d => d.textContent = texto);
        }

        window.onload = function() {
            loadFromLocal();
            updateGroupDropdown();
        };
    </script>
</body>

</html>


